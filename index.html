<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Pet Feeder</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav>
    <h1>Smart Pet Feeder</h1>
  </nav>

  <div class="container">
    <div class="section">
      <h2>1. Set Schedule</h2>
      <form id="schedule-form">
        <label>Select Days:</label><br>
        <div class="days">
          <label><input type="checkbox" name="day" value="Mon">Mon</label>
          <label><input type="checkbox" name="day" value="Tue">Tue</label>
          <label><input type="checkbox" name="day" value="Wed">Wed</label>
          <label><input type="checkbox" name="day" value="Thu">Thu</label>
          <label><input type="checkbox" name="day" value="Fri">Fri</label>
          <label><input type="checkbox" name="day" value="Sat">Sat</label>
          <label><input type="checkbox" name="day" value="Sun">Sun</label>
        </div>

        <label>Number of feed times (per day):</label>
        <select id="feed-count" onchange="generateTimeInputs()">
          <option value="0">Select</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>

        <div id="time-inputs"></div>

        <button type="submit" class="btn">Save Schedule</button>
      </form>
    </div>

    <div class="section">
      <h2>2. Direct Control</h2>
      <button id="toggle-btn" class="btn" onclick="toggleServo()">Turn ON</button>
    </div>
  </div>

  <script>
    let isOn = false;

    function toggleServo() {
      fetch("/toggle")
        .then(res => res.text())
        .then(data => {
          isOn = !isOn;
          document.getElementById("toggle-btn").textContent = isOn ? "Turn OFF" : "Turn ON";
        });
    }

    function generateTimeInputs() {
      const count = parseInt(document.getElementById("feed-count").value);
      const container = document.getElementById("time-inputs");
      container.innerHTML = '';
      for (let i = 0; i < count; i++) {
        container.innerHTML += `<label>Feed time ${i + 1}:</label><input type="time" name="feedTime${i + 1}" required><br>`;
      }
    }

    document.getElementById("schedule-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const days = Array.from(document.querySelectorAll('input[name="day"]:checked')).map(d => d.value);
      const times = Array.from(document.querySelectorAll('input[type="time"]')).map(t => t.value);

      const payload = JSON.stringify({
        days: days,
        times: times
      });

      fetch("/save_schedule", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: payload
      })
      .then(res => res.text())
      .then(msg => alert(msg));
    });
  </script>
</body>
</html>
